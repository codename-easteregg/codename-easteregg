// @ts-check

export const css = (string) => string;

export const BADGE = `
<svg part="icon" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.cls-2{fill:#e00}.cls-3{fill:#fff}</style></defs><path class="cls-2" d="M64.54 111.07H43.72c-.55 0-1-.45-1-1s.45-1 1-1h20.82c.55 0 1 .45 1 1s-.45 1-1 1Z"/><circle class="cls-2" cx="38.71" cy="110.07" r=".88"/><circle class="cls-2" cx="32.84" cy="110.07" r=".88"/><path class="cls-2" d="M26.01 109.26c.78 0 .89-.43.89-.81 0-.31-.04-.61-.09-.92s-.09-.6-.09-.91c0-1.01.66-1.44 1.59-1.44h.23v.6h-.2c-.65 0-.87.35-.87.94 0 .25.03.52.08.78.04.27.08.54.08.83.01.7-.3 1.05-.79 1.19v.02c.49.12.8.49.79 1.2 0 .3-.03.57-.08.83-.04.27-.08.53-.08.79 0 .62.25.96.87.96h.2v.6h-.23c-.91 0-1.59-.4-1.59-1.5 0-.3.04-.6.09-.9s.09-.59.09-.89c0-.34-.11-.81-.89-.81v-.56Z"/><path class="cls-2" d="M28.55 105.18v.6h-.2c-.65 0-.87.35-.87.94 0 .25.03.52.08.78.04.27.08.54.08.83.01.7-.3 1.05-.79 1.19v.02c.49.12.8.49.79 1.2 0 .3-.03.57-.08.83-.04.27-.08.53-.08.79 0 .62.25.96.87.96h.2v.6h-.23c-.91 0-1.59-.4-1.59-1.5 0-.3.04-.6.09-.9.04-.3.09-.59.09-.89 0-.34-.11-.81-.89-.81v-.56c.78 0 .89-.43.89-.81 0-.31-.04-.61-.09-.92-.04-.31-.09-.6-.09-.91 0-1.01.66-1.44 1.59-1.44h.23m0-.35h-.23c-1.22 0-1.94.67-1.94 1.79 0 .32.04.62.09.92.05.34.09.63.09.91s-.04.46-.54.46c-.19 0-.35.16-.35.35v.56c0 .19.16.35.35.35.5 0 .54.21.54.46 0 .27-.04.55-.08.84-.04.28-.09.62-.09.95 0 1.18.71 1.85 1.94 1.85h.23c.19 0 .35-.16.35-.35v-.6c0-.19-.16-.35-.35-.35h-.2c-.34 0-.52-.1-.52-.61 0-.23.03-.46.07-.74.06-.34.08-.61.08-.89 0-.6-.19-.98-.43-1.21.25-.24.44-.61.43-1.2 0-.33-.04-.62-.08-.88-.05-.3-.07-.53-.07-.72 0-.51.16-.59.52-.59h.2c.19 0 .35-.16.35-.35v-.6c0-.19-.16-.35-.35-.35ZM73.92 132.72H53.9c-.55 0-1-.45-1-1s.45-1 1-1h20.02c.55 0 1 .45 1 1s-.45 1-1 1ZM50.03 134.73c-.14 0-.28-.04-.4-.12l-3.53-2.25c-.22-.14-.35-.38-.35-.63s.13-.49.35-.63l3.53-2.25c.35-.22.81-.12 1.04.23s.12.81-.23 1.04l-2.54 1.62 2.54 1.62a.756.756 0 0 1-.4 1.39Z"/><path class="cls-2" d="m107.98 50.37 13.44 27.23c.47.95 1.37 1.61 2.42 1.76l30.05 4.37c5.28.77 7.14 6.49 3.32 10.21l-20.03 19.99c-1.52 1.48-2.47 4.4-2.11 6.49l4.85 28.26c.9 5.26-4.62 9.27-9.34 6.79l-26.88-14.13c-.94-.49-2.06-.49-3 0l-26.88 14.13c-4.72 2.48-10.24-1.53-9.34-6.79l5.13-29.93c.18-1.04-.17-2.11-.93-2.85L46.94 94.71c-3.82-3.72-1.71-10.21 3.57-10.98l30.05-4.37c1.05-.15 1.95-.81 2.42-1.76l13.44-27.23c2.36-4.78 9.18-4.78 11.54 0Z"/><path class="cls-3" d="m110.02 47.37 13.44 27.23c.47.95 1.37 1.61 2.42 1.76l30.05 4.37c5.28.77 7.39 7.26 3.57 10.98l-20.53 20.01a6.427 6.427 0 0 0-1.85 5.7l4.85 28.26c.9 5.26-4.62 9.27-9.34 6.79l-26.88-14.13c-.94-.49-2.06-.49-3 0l-26.88 14.13c-4.72 2.48-10.24-1.53-9.34-6.79l5.13-29.93c.18-1.04-.17-2.11-.93-2.85L48.99 91.71c-3.82-3.72-1.71-10.21 3.57-10.98l30.05-4.37c1.05-.15 1.95-.81 2.42-1.76l13.44-27.23c2.36-4.78 9.18-4.78 11.54 0Z"/><path class="cls-2" d="M72.87 153.71c-1.43 0-2.85-.45-4.07-1.33a6.896 6.896 0 0 1-2.76-6.79l5.13-29.93c.15-.88-.14-1.78-.78-2.41L48.65 92.06a6.91 6.91 0 0 1-1.76-7.11 6.889 6.889 0 0 1 5.6-4.72l30.05-4.37c.89-.13 1.65-.68 2.05-1.49l13.44-27.23c1.18-2.39 3.56-3.87 6.22-3.87s5.04 1.48 6.22 3.87l13.44 27.23c.4.8 1.16 1.36 2.05 1.49l30.05 4.37c2.63.38 4.78 2.19 5.6 4.72s.15 5.25-1.76 7.11l-20.53 20.01a5.93 5.93 0 0 0-1.71 5.25l4.85 28.26c.45 2.62-.61 5.22-2.76 6.79a6.903 6.903 0 0 1-7.31.53l-26.88-14.13c-.79-.42-1.74-.42-2.53 0L76.1 152.9c-1.02.54-2.13.8-3.23.8Zm31.38-109.42c-2.31 0-4.3 1.24-5.32 3.31L85.49 74.83a3.693 3.693 0 0 1-2.8 2.03l-30.05 4.37c-2.29.33-4.08 1.84-4.79 4.04s-.15 4.47 1.5 6.09l21.74 21.19a3.69 3.69 0 0 1 1.07 3.29l-5.13 29.93c-.39 2.28.49 4.45 2.36 5.81 1.87 1.36 4.21 1.53 6.25.45l26.88-14.13c1.08-.57 2.38-.57 3.46 0l26.88 14.13c2.04 1.07 4.38.91 6.25-.45s2.75-3.53 2.36-5.81l-4.85-28.26c-.39-2.25.36-4.55 1.99-6.14l20.53-20.01c1.65-1.61 2.22-3.89 1.5-6.09s-2.51-3.71-4.79-4.04l-30.05-4.37a3.74 3.74 0 0 1-2.8-2.03L109.56 47.6c-1.02-2.07-3.01-3.31-5.32-3.31Z"/><path d="M104.17 130.94c0 .74-.41 1.43-1.07 1.77l-22.49 11.73c-4.09 2.15-8.87-1.32-8.09-5.88l4.45-23.92c.16-.9-.14-1.83-.8-2.47L57.34 93.81c-3.31-3.23-1.48-8.84 3.09-9.51l26.02-3.78c.91-.13 1.69-.7 2.1-1.52l11.64-23.58c1.02-2.07 3.32-3.11 4.02-3.11l-.03 78.62Z" fill="#f5d8d6"/><g id="Magnifying_glass" data-name="Magnifying glass"><path id="Path_1486" data-name="Path 1486" class="cls-2" d="M97.66 59.52a26.236 26.236 0 0 0-2.63 13.83c1.2 14.48 13.92 25.25 28.4 24.04 14.48-1.2 25.25-13.92 24.04-28.4-1.2-14.48-13.92-25.25-28.4-24.04-9.53.79-17.46 6.57-21.41 14.56m44.82 20.75c-3.26 7.59-10.5 13.18-19.31 13.91-12.71 1.06-23.86-8.39-24.92-21.1s8.39-23.86 21.1-24.92c12.71-1.06 23.86 8.39 24.92 21.1.32 3.9-.34 7.65-1.78 11.01"/><path class="cls-3" d="M142.48 80.27c-3.26 7.59-10.5 13.18-19.31 13.91-12.71 1.06-23.86-8.39-24.92-21.1s8.39-23.86 21.1-24.92c12.71-1.06 23.86 8.39 24.92 21.1.32 3.9-.34 7.65-1.78 11.01"/><path id="Path_1487" data-name="Path 1487" class="cls-2" d="M80.77 116.49c-.56.7-.45 1.71.24 2.28s1.71.45 2.28-.24l14.26-16.84c1.38-1.58-1.14-3.71-2.47-2.09l-14.26 16.84s-.03.04-.05.06Z"/><path id="Path_1488" data-name="Path 1488" class="cls-2" d="M119.64 52.74c-.89.1-1.52.89-1.43 1.78.1.89.89 1.52 1.78 1.43 8.41-.68 15.79 5.56 16.5 13.97V70c.1.89.89 1.52 1.78 1.43.89-.1 1.52-.89 1.43-1.78-.85-10.19-9.79-17.76-19.98-16.92h-.08Z"/><path id="Path_1489" data-name="Path 1489" class="cls-2" d="M100.93 93.42a1.6 1.6 0 0 0-1.47 1.74v.05a1.638 1.638 0 1 0 1.47-1.79Z"/></g><path class="cls-2" d="M156.08 122.38h-12.96c-.55 0-1-.45-1-1s.45-1 1-1h12.96c.55 0 1 .45 1 1s-.45 1-1 1ZM137.01 122.38H122.1c-.55 0-1-.45-1-1s.45-1 1-1h14.91c.55 0 1 .45 1 1s-.45 1-1 1ZM110.23 122.38h-3.95c-.55 0-1-.45-1-1s.45-1 1-1h3.95c.55 0 1 .45 1 1s-.45 1-1 1Z"/><circle class="cls-2" cx="116.1" cy="121.38" r=".88"/><path class="cls-2" d="M160.45 124.38c-.25 0-.49-.12-.63-.35a.758.758 0 0 1 .23-1.04l2.54-1.62-2.54-1.62c-.35-.22-.45-.69-.23-1.04s.69-.45 1.04-.23l3.53 2.25c.22.14.35.38.35.63s-.13.49-.35.63l-3.53 2.25c-.12.08-.26.12-.4.12ZM101.48 124.38c-.14 0-.28-.04-.4-.12l-3.53-2.25c-.22-.14-.35-.38-.35-.63s.13-.49.35-.63l3.53-2.25c.35-.22.81-.12 1.04.23.22.35.12.81-.23 1.04l-2.54 1.62 2.54 1.62a.756.756 0 0 1-.4 1.39Z"/></svg>
`

export const ASCII_MESSAGE = `
<!--
             .rRRRrr;;rRRRRRRRrr,.                
            .hHHHHHHHHHHHHHHHHHHhh,.            
            rRRRRRRRRRRRRRRRRRRRRRRRRRr.          
           ;HHHHHHHHHHHHHHHHHHHHHHHHHHH.          
          .RRRRRRRRRRRRRRRRRRRRRRRRRRRRR'         
          :HHHHHHHHHHHHHHHHHHHHHHHHHHHHHh         
   .,:rhh'.rRRRRRRRRRRRRRRRRRRRRRRRRRRRRR'        
.hHHHHHHHh  .hHHHHHHHHHHHHHHHHHHHHHHHHHHHh        
RRRRRRRRRR,    ,RRRRRRRRRRRRRRRRRRRRRRRRRr        
HHHHHHHHHHHh.     .;hhHHHHHHHHHHHHHHHHHHh,:r,.    
RRRRRRRRRRRRRr;.       .',;rhrhhrrrrhh:'  hRRRh.  
,HHHHHHHHHHHHHHHrr'.                     ,HHHHHHr.
 .hRRRRRRRRRRRRRRRRRhrr,'...         ..;hRRRRRRRRr
   .rHHHHHHHHHHHHHHHHHHHHHHHHhrrrrrrhhHHHHHHHHHHHH
      ,rRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR
        .,hrHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHr
            .,rhRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRr.
                 .,rrrhHHHHHHHHHHHHHHHHHHHHHHhr.  
                      .';:rhhRRRRRRRRRRRRhr;.     

Traditionally, the word "source" in "open source" referred to the term "source code." Source code is what computer programmers use to create software. Typically source code is invisible to most users.

At Red Hat, we believe that open source way unlocks the world's potential to share knowledge and build upon each other's discoveries.

Unlock your potential by creating your own "red" hat.

- [ ] Modify the color of the hat in the footer of the site with the officially Red Hat branded red.
 - https://ux.redhat.com/foundations/color/#brand
 - https://www.digitalocean.com/community/tutorials/devtools-color-picker
-->
`

/**
 * Countdown timer as an observable.
 *
 * @param {number} timeout - Specified time to resolve the countdown specified in seconds.
 * @param {?(number) => void} callback - Callback that updates on countdown change.
 * @returns {{ cancel?: (string) => void, promise: Promise<void>}}
 */
export function countdown(timeout, callback = null) {
  const ret = {};
  const signal = new Promise((res, rej) => {
    ret.cancel = (err) => {
      rej(new Error(err));
    }
  });

  /**
   * @type {Promise<void>}
   */
  ret.promise = new Promise((res, rej) => {
    let index = timeout;
    const interval = setInterval(() => {
      index--
      if (!!callback) {
        callback(index);
      }
      if (index <= 0) {
        res();
        clearInterval(interval);
      }
    }, 1000);

    signal.catch(err => {
      rej(err);
      clearInterval(interval);
    })
  });

  return ret;
}

/**
 * Promised based countdown timer.
 * @param {HTMLElement | SVGSVGElement} el - Specified time to resolve the countdown specified in seconds.
 * @returns {{ cancel?: (string) => void, promise: Promise<void>}}
 */
export function styleMonitor(el) {
  const ret = {};
  const signal = new Promise((res, rej) => {
    ret.cancel = (err) => {
      rej(new Error(err));
    }
  });

  /**
   * @type {Promise<void>}
   */
  ret.promise = new Promise((res, rej) => {
    console.log('Waiting for color fix.');
    const interval = setInterval(() => {
      const computedStyle = window.getComputedStyle(el);
      // check the correct fill color of the svg
      if (computedStyle.fill === 'rgb(238, 0, 0)') {
        res();
        clearInterval(interval);
      }
    }, 1000);

    signal.catch(err => {
      rej(err);
      clearInterval(interval);
    })
  });

  return ret;
}

/**
 * @return {Promise<SVGSVGElement | null | undefined>}
 */
export function footerSVG() {
  return customElements.whenDefined('rh-global-footer')
    .then(async () => {
      const footer = document.querySelector('rh-global-footer');
      // @ts-ignore
      await footer.updateComplete;
      return footer?.shadowRoot?.querySelector('svg');
    })
}

/**
 *
 * @param {'wiggle' | 'pop'} animation
 */
export async function animateSVG(animation) {
  // wait for the footer to become available
  const svg = await footerSVG();
  if (animation === 'wiggle') {
    return svg?.animate(
      [
        { transform: 'rotate(0)' },
        { transform: 'rotate(15deg)' },
        { transform: 'rotate(-11deg)' },
        { transform: 'rotate(0)' },
        { transform: 'rotate(8deg)' },
        { transform: 'rotate(-3deg)' },
        { transform: 'rotate(0)' },
      ],
      {
        duration: 2000,
        easing: 'cubic-bezier(0.42, 0, 0.58, 1)'
      }
    );
  }
  else if (animation === 'pop') {
    return svg?.animate(
      [
        { transform: 'none' },
        { transform: 'translateY(-50%)' },
        { transform: 'none' },
      ],
      {
        duration: 1000,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      }
    );
  }
}

/**
 * Convert string to pascal case
 * @param {string} string
 * @return {string}
 */
export function pascalCase(string) {
  return string.replace(/(\w)(\w*)/g,
    function (g0, g1, g2) { return g1.toUpperCase() + g2.toLowerCase(); });
}

/**
 * @param {string} domain
 */
export function setVerificationCookie(domain = 'localhost') {
  const cname = 'easteregg';
  const cvalue = 'complete';
  const days = 30;
  const dt = new Date();
  dt.setTime(dt.getTime() + (days * 24 * 60 * 60 * 1000));
  const expires = "; expires=" + dt.toGMTString();
  document.cookie = `${cname}=${cvalue}${expires}; domain=${domain}`
}

export async function shootConfetti() {
  // @ts-ignore
  await import('https://unpkg.com/lit-confetti/dist/esm/index.js?module')
  document.body.insertAdjacentHTML('beforeend', `<lit-confetti gravity="1" count="40"></lit-confetti>`)
}

export async function startEndScreen() {
  // get collapse all body
  const body = document.querySelector('#main-content');
  const footer = document.querySelector('rh-footer');
  const globalFooter = document.querySelector('rh-global-footer');
  // @ts-ignore
  const collapseAnimation = ({ start, end }) => [
    [
      { maxHeight: start },
      { maxHeight: end },
    ],
    {
      duration: 1000,
      fill: 'forwards'
    }
  ];
  // @ts-ignore
  footer?.parentElement?.appendChild(globalFooter);
  globalFooter?.removeAttribute('slot');
  // @ts-ignore
  body?.style.setProperty('overflow', 'hidden');
  // @ts-ignore
  footer?.style.setProperty('overflow', 'hidden');
  // @ts-ignore
  body?.animate(...collapseAnimation({ start: '100vh', end: '0px' }));
  // @ts-ignore
  footer?.animate(...collapseAnimation({ start: '100vh', end: '95px' }));
  // fade out content
}

/**
 * Add a tooltip to an element
 * @param { Element } target
 * @param { string } html
 */
export async function addTooltip(target, html) {
  import('./components/rh-cnee-tooltip.js');
  // @ts-ignore
  const template = document.createElement('template');
  template.innerHTML = `<rh-cnee-tooltip></rh-cnee-tooltip>`;
  // template.innerHTML = `<rh-tooltip></rh-tooltip>`;
  const clone = template.content.cloneNode(true);
  target.parentNode?.appendChild(clone);
  const newEl = target.parentNode?.querySelector('rh-cnee-tooltip');
  newEl?.appendChild(target);
}

export function showEndscreenModal() {
  import('./components/rh-cnee-popup.js');
  const template = document.createElement('template');
  template.innerHTML = `<rh-cnee-popup></rh-cnee-popup>`;
  const clone = template.content.cloneNode(true);
  document.body.appendChild(clone);
}

/**
 * DocumentReadyState as an observable.
 *
 * @param {?(DocumentReadyState) => void} callback - Callback that updates on readstate change.
 * @returns {{ cancel?: (string) => void, promise: Promise<DocumentReadyState>}}
 */
export function readyStateObservable(callback = null) {
  const ret = {};
  const signal = new Promise((res, rej) => {
    ret.cancel = (state) => {
      res(state);
    }
  });

  /**
   * @type {Promise<DocumentReadyState>}
   */
  ret.promise = new Promise((res, rej) => {
    evaluate();
    document.addEventListener('readystatechange', evaluate);

    signal.then(state => {
      document.removeEventListener('readystatechange', evaluate);
      res(state);
    })
  });

  function evaluate(e) {
    const state = document.readyState;
    if (typeof callback === 'function') {
      callback(state);
    }
    if (state === 'complete') {
      ret.cancel(state);
    }
  }

  return ret;
}